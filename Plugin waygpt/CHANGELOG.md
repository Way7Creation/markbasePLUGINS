# История изменений Plugin WayGPT

В этом документе фиксируются все правки: критические исправления, обновления функций, улучшения и исправления багов.

---

## Формат записей

- **Критические** — влияют на безопасность или стабильность, требуют немедленного обновления.
- **Обновление функций** — новые возможности, изменения контракта API (обратная совместимость по возможности).
- **Улучшения** — рефакторинг, типизация, документация, UX.
- **Исправления багов** — устранение ошибок в работе кода.

---

## [1.1.0] — 2026-01-22

### Обновление функций

- **use_case вместо use_case_id**: в чат-запросах передаётся **ключ** сценария (`key`), например `support_chat`. Параметр `use_case` (JS: `useCase`) — основной; `use_case_id` оставлен как устаревший алиас.
- **getUseCases / get_use_cases**: получение списка сценариев по project key. Поддержка во всех клиентах (JS, Python, PHP).
- **Сценарии с внешнего сервера**: создание, обновление и удаление сценариев — через Client API с JWT (логин → CRUD). Документация: раздел «Управление сценариями с внешнего сервера» в интеграции.

### Улучшения

- Синхронизация плагина с API и документацией: use_case (key), список сценариев, CRUD через Client API.
- В примере `example-basic.js` добавлен пример 3: получение списка сценариев (`getUseCases`).
- Обновлён README: примеры с `use_case`, `get_use_cases` / `getUseCases`, описание CRUD по JWT.

### Исправления багов

- **Python (waygpt_client.py)**:
  - Исправлены ошибки типизации (basedpyright): `Optional` для параметров `__init__`, `messages`, `body` в HMAC.
  - Устранена передача `None` в параметры, ожидающие `str` или `List[Dict]`.
  - Защита от `None` при `hmac_secret.encode` в HMAC-подписи.
  - Исправлена переменная `response` → `resp` в `_chat_completions_stream` (в `finally` вызывалось `response.close()`).
  - Явная инициализация `error_data` в блоке обработки ошибок `_make_request`, чтобы не ссылаться на необъявленную переменную в `except`.
  - Типы возврата: `cast` для `_make_request` в методах, возвращающих `Dict` или `List`; аннотации `Dict[str, Any]`, `List[Dict[str, Any]]`.
  - `from __future__ import annotations` перенесён в начало файла (до остальных импортов).

---

## [1.2.0] — 2026-01-22

### Обновление функций

- **Client API для управления проектами и сценариями:** добавлены методы для полного управления проектами и сценариями через JWT авторизацию:
  - `client_login()` / `clientLogin()` / `clientLogin()` — авторизация и получение JWT токена
  - Управление проектами: `client_list_projects()`, `client_get_project()`, `client_create_project()`, `client_update_project()`, `client_delete_project()`
  - Управление сценариями: `client_list_use_cases()`, `client_get_use_case()`, `client_create_use_case()`, `client_update_use_case()`, `client_delete_use_case()`
  - Поддержка во всех языках: Python, JavaScript, PHP

### Улучшения

- **Улучшен метод получения сценариев:** `get_use_cases()` / `getUseCases()` / `getUseCases()` теперь поддерживает параметр `detailed` для запроса полной информации о сценариях
- **Полная документация:** добавлена подробная документация по Client API в README с примерами для всех языков
- **Обратная совместимость:** все существующие методы работают без изменений, новые методы добавлены без влияния на старый функционал

### Исправления багов

- Улучшена обработка ошибок в Client API методах
- Исправлена типизация в Python плагине для Client API методов

---

## [1.1.1] — 2026-01-22

### Улучшения

- **Проверка совместимости:** изменений в коде плагина нет. Логирование (UsageLog, Transaction), статистика по сценариям/типам (`usage_by_function`) и разбивка «что тратится на что» реализованы **на стороне сервера**. Плагин по‑прежнему совместим с актуальным API.
- **Документация:** полное описание сценариев, поиска по фото, логирования и статистики — в `frontend/public/docs/integration` (файлы `SCENARIOS_FLEXIBILITY_AND_LOGGING_RU.md`, `FULL_AI_SERVER_UNIVERSAL_INTEGRATION_GUIDE_RU.md`). Для вызовов API используйте плагин (JS/Python/PHP) или прямые HTTP-запросы по этой документации.

---

## [1.0.0] — 2024

- Первый релиз: чат, генерация изображений и видео, мультимодальный чат, HMAC, widget token, модели.

---

**Как обновлять этот файл**

1. При каждом изменении в плагине добавлять запись в `[X.Y.Z]` с датой.
2. Относить каждое изменение к одной из категорий: **Критические**, **Обновление функций**, **Улучшения**, **Исправления багов**.
3. Кратко описывать, что именно сделано и в каких файлах (при необходимости).
